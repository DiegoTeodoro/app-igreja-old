<form [formGroup]="notaFiscalForm" (ngSubmit)="onSubmit()">
  <!-- Campos de nota fiscal -->
  <mat-form-field>
    <mat-label>Número da Nota</mat-label>
    <input matInput formControlName="numero_nota" required>
  </mat-form-field>

  <mat-form-field>
    <mat-label>Série</mat-label>
    <input matInput formControlName="serie" required>
  </mat-form-field>

  <!-- Lista de Itens -->
  <div formArrayName="itens" *ngFor="let item of itens.controls; let i = index;">
    <div [formGroupName]="i" class="item-group">
      <mat-form-field>
        <mat-label>Produto</mat-label>
        <mat-select formControlName="produto_id">
          <mat-option *ngFor="let produto of produtos" [value]="produto.id">{{ produto.nome }}</mat-option>
        </mat-select>
      </mat-form-field>

      <mat-form-field>
        <mat-label>Quantidade</mat-label>
        <input matInput type="number" formControlName="quantidade" (change)="calculateTotal(i)">
      </mat-form-field>

      <mat-form-field>
        <mat-label>Valor Unitário</mat-label>
        <input matInput type="number" formControlName="valor_unitario" (change)="calculateTotal(i)">
      </mat-form-field>

      <mat-form-field>
        <mat-label>Valor Total</mat-label>
        <input matInput formControlName="valor_total" [attr.disabled]="true">
      </mat-form-field>
      

      <button mat-icon-button color="warn" (click)="removeItem(i)"> 
        <mat-icon>delete</mat-icon> 
      </button>
    </div>
  </div>

  <button mat-button (click)="addItem()">Adicionar Item</button>

  <!-- Botões de ação -->
  <button mat-button type="submit" [disabled]="notaFiscalForm.invalid">Salvar Nota Fiscal</button>
</form>
